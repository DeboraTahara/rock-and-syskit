<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="IE=edge" http-equiv="X-UA-Compatible">
        <meta charset="utf-8">
        <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Robot Construction Toolkit</title>

        <link href="../images/favicon.ico" rel="icon" type="image/ico" relative="true" />
        <link href="../stylesheets/site.css" rel="stylesheet" />
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <style>
          /* Remove the navbar's default margin-bottom and rounded borders */
          .navbar {
              margin-bottom: 0;
              border-radius: 0;

          }

          /* Set height of the grid so .sidenav can be 100% (adjust as needed) */
          .row.content {height: 450px}

          /* Set gray background color and 100% height */
          .sidenav {
              padding-top: 20px;
              background-color: #f1f1f1;
              height: 100%;
          }

          /* Set black background color, white text and some padding */
          footer {
              background-color: #000000;
              color: white;
              padding: 5px;
          }

          /* On small screens, set height to 'auto' for sidenav and grid */
          @media screen and (max-width: 767px) {
              .sidenav {
                  height: auto;
                  padding: 15px;
              }
              .row.content {height:auto;}
          }
        </style>
    </head>

    <body class="syskit_basics syskit_basics_deployment">

            <!-- top navbar -->
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li><a href="../">Home</a></li>
                    <li><a href="../about.html">About</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row content">
            <div class="col-sm-3 sidenav">
                <ul><li class='child '><a href="../">Building robots with Rock and Syskit</a></li><li class='parent '><span class='parent-label'><a href="../workspace/">The Workspace</a></span><ul><li class='child '><a href="../workspace/">Introduction</a></li><li class='child '><a href="../workspace/install.html">Installing Rock</a></li><li class='child '><a href="../workspace/day_to_day.html">Day-to-day</a></li></ul></li><li class='parent '><span class='parent-label'><a href="./">Basics</a></span><ul><li class='child '><a href="./">Introduction</a></li><li class='child '><a href="getting_started.html">Getting Started</a></li><li class='child '><a href="composition.html">Compositions</a></li><li class='child '><a href="constant_generator.html">Constant Generator</a></li><li class='child '><a href="devices.html">Devices</a></li><li class='child active'><a href="deployment.html">Deployment</a></li></ul></li><li class='parent '><span class='parent-label'><a href="../transformations/">Transformations</a></span><ul><li class='child '><a href="../transformations/">Geometric Relations</a></li></ul></li></ul>
            </div>
            <div class="col-sm-7 text-left">
                <h1 id="profiles-actions-and-deployments">Profiles, Actions and Deployments:</h1>

<h2 id="running-the-arm-control-network">Running the arm control network</h2>

<p>A few things are missing before we can actually run <a href="constant_generator.html">the network we just
created</a>:</p>

<ol>
  <li>Deploy the components</li>
  <li>Configure the components</li>
  <li>Bind the network to the actual arm in Gazebo</li>
  <li>Export the network as a Syskit Action so that we can instruct Syskit to start it</li>
</ol>

<h2 id="component-deployment">Component deployment</h2>

<p>When declared in oroGen files, components are a functional encapsulation of a
function. At this stage, a "component" is really just a class which embeds code
in a specific, normalized way, and that has predefined inputs, outputs and
configuration parameters.</p>

<p>To actually run a component, one needs to declare how it will be supported by
the operating system's runtime ressources (how the components are mapped to
processes and threads), and when the component will be processing its data
(periodically, triggered by its inputs). Moreover, the component is given a name
so that it can be discovered by Rock's inspection tools, and so that its outputs
can be found in the data logged at runtime.</p>

<p>All oroGen components have a default deployment scheme of one component per
process. The triggering mechanism does not have a default, but the
<code>port_driven</code> scheme (where the component is triggered whenever data is
received on its inputs) is a very common scheme. If you look into the
<code>cart_ctrl_wdls</code> package, you would see that</p>

<p>One usually starts with the defaults defined in the oroGen file. We therefore
only have left to give a name to the components Syskit is using. This is done
in the robot's config file with:</p>

<pre class="highlight ruby"><code><span class="no">Robot</span><span class="p">.</span><span class="nf">requires</span> <span class="k">do</span>
  <span class="nb">require</span> <span class="s1">'models/compositions/arm_cartesian_control_wdls'</span>
  <span class="no">Syskit</span><span class="p">.</span><span class="nf">conf</span><span class="p">.</span><span class="nf">use_deployment</span> <span class="s1">'cart_ctrl_wdls::CartCtrl'</span> <span class="o">=&gt;</span> <span class="s1">'arm_pos2twist'</span>
  <span class="no">Syskit</span><span class="p">.</span><span class="nf">conf</span><span class="p">.</span><span class="nf">use_deployment</span> <span class="s1">'cart_ctrl_wdls::WDLSSolver'</span> <span class="o">=&gt;</span> <span class="s1">'arm_twist2joint'</span>
  <span class="no">Syskit</span><span class="p">.</span><span class="nf">conf</span><span class="p">.</span><span class="nf">use_deployment</span> <span class="s1">'robot_frames::SingleChainPublisher'</span> <span class="o">=&gt;</span> <span class="s1">'arm_chain_publisher'</span>
<span class="k">end</span>
</code></pre>
<p>Let's finally integrate the generator and the control network in a
<code>ArmCartesianConstantControl</code> composition. Generate it and link the command to
the control.</p>

<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'models/compositions/arm_cartesian_constant_generator'</span>
<span class="nb">require</span> <span class="s1">'models/compositions/arm_cartesian_control_wdls'</span>

<span class="k">module</span> <span class="nn">SyskitBasics</span>
  <span class="k">module</span> <span class="nn">Compositions</span>
    <span class="k">class</span> <span class="nc">ArmCartesianConstantControl</span> <span class="o">&lt;</span> <span class="no">Syskit</span><span class="o">::</span><span class="no">Composition</span>
      <span class="n">add</span> <span class="no">ArmCartesianConstantGenerator</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'command'</span>
      <span class="n">add</span> <span class="no">ArmCartesianControlWdls</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'control'</span>
      <span class="n">command_child</span><span class="p">.</span><span class="nf">out_port</span><span class="p">.</span>
        <span class="nf">connect_to</span> <span class="n">control_child</span><span class="p">.</span><span class="nf">command_port</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="configuring-the-components">Configuring the components</h3>

<p>Configuration of components in a Syskit system is split into two parts:</p>

<ul>
  <li>"dynamic" configuration: parameters that cannot be known at design
time, will be changed each time an action is started, or are to be
extracted from other information such as the world definition (SDF model).
These are represented as <strong>task arguments</strong>. This is the mean <a href="constant_generator.html">we just
saw</a> to parametrize the setpoint of the
cartesian controller.</li>
  <li>"static" configuration: parameters that are known at design time. Most
of the algorithm parameters fit into this category. These are the subject
of this section.</li>
</ul>

<p>The static configuration is stored within YAML files in <code>config/orogen/</code>. Each
file is named after the component model that is configured, so for instance
<code>config/orogen/cart_ctrl_wdls::WDLSSolver</code> stores the configuration of all
components under that name. Each file can contain multiple configurations
within sections, but for now we'll only use the <code>default</code> configuration,
which is the one that is loaded by default unless specified otherwise.</p>

<p>Let's generate configuration file templates for the components we are using. The
files are generated with the default configuration exposed by the components.</p>

<pre class="highlight plaintext"><code>$ syskit gen orogenconf cart_ctrl_wdls::WDLSSolver
      create  config/orogen/
      create  config/orogen/cart_ctrl_wdls::WDLSSolver.yml
$ syskit gen orogenconf cart_ctrl_wdls::CartCtrl
      exists  config/orogen/
      create  config/orogen/cart_ctrl_wdls::CartCtrl.yml
$ syskit gen orogenconf robot_frames::SingleChainProducer
      exists  config/orogen/
      create  config/orogen/robot_frames::SingleChainPublisher.yml
</code></pre>
<p>Each properties in the generated files have their corresponding configuration.
Let's look at them one by one, to see what needs to actually be configured.</p>

<ul>
  <li><code>cart_ctrl_wdls::WDLSSolver</code>. There are robot model parameters as well as tip
and root, but as we described above, these are best handled within Syskit
itself.  The only algorithm parameter that does not seem to have a sane
default is the <code>lambda</code> parameter. The documentation mentions 0.1 has a
known-good parameter for some arm, let's pick that and keep in mind that it
might be wrong.</li>
  <li><code>cart_ctrl_wdls::CartCtrl</code>. The one parameter that is probably best changed is
the max output. The component's designer decided to pick <code>RigidBodyState</code> to
represent a twist, which means that we only need to update the velocity
and angular velocity fields. Let's set <code>0.1</code> in linear and <code>2.deg</code> in angular
(the <code>.deg</code> suffix will convert a degree value in radians).</li>
  <li><code>robot_frames::SingleChainPublisher</code> only has robot model and tip/root parameters.</li>
</ul>


            </div>
        </div>
    </div>


        <footer class="container-fluid text-center">
            <p>Rock in your own way!</p>
        </footer>
    </body>
</html>
